<pou name="PIDController" pouType="functionBlock">
    <interface>
        <inOutVars>
            <variable name="MTPBase"><type><derived name="PIDCtrl" /></type></variable>
        </inOutVars>
        <inputVars>
            <variable name="id"><type><INT /></type></variable>
            <variable name="activateManualSP"><type><BOOL /></type></variable>
            <variable name="activateDynamicSP"><type><BOOL /></type></variable>
            <variable name="activateFixedSP"><type><BOOL /></type></variable>
            <variable name="dynamicSP"><type><REAL /></type></variable>
            <variable name="fixedSP"><type><REAL /></type></variable>
            <variable name="rawValue"><type><WORD /></type></variable>
            <variable name="valueUnit"><type><INT /></type></variable>
            <variable name="manipulatedValueUnit"><type><INT /></type></variable>
            <variable name="scaleMin"><type><REAL /></type></variable>
            <variable name="scaleMax"><type><REAL /></type></variable>
            <variable name="scaleMinMV"><type><REAL /></type></variable>
            <variable name="scaleMaxMV"><type><REAL /></type></variable>
            <variable name="proportional"><type><REAL /></type></variable>
            <variable name="integration"><type><REAL /></type></variable>
            <variable name="derivation"><type><REAL /></type></variable>
            <variable name="alarmHigh"><type><REAL /></type></variable>
            <variable name="warningHigh"><type><REAL /></type></variable>
            <variable name="toleranceHigh"><type><REAL /></type></variable>
            <variable name="toleranceLow"><type><REAL /></type></variable>
            <variable name="warningLow"><type><REAL /></type></variable>
            <variable name="alarmLow"><type><REAL /></type></variable>
            <variable name="alarmHighEn"><type><BOOL /></type></variable>
            <variable name="warningHighEn"><type><BOOL /></type></variable>
            <variable name="toleranceHighEn"><type><BOOL /></type></variable>
            <variable name="toleranceLowEn"><type><BOOL /></type></variable>
            <variable name="warningLowEn"><type><BOOL /></type></variable>
            <variable name="alarmLowEn"><type><BOOL /></type></variable>
            <variable name="deadband"><type><REAL /></type></variable>
            <variable name="externalFault"><type><BOOL /></type></variable>
        </inputVars>
        <outputVars>
            <variable name="setpointOut"><type><REAL /></type></variable>
            <variable name="valueOut"><type><REAL /></type></variable>
            <variable name="manipulatedValue"><type><REAL /></type></variable>
            <variable name="remote"><type><BOOL /></type></variable>
            <variable name="operatorMode"><type><BOOL /></type></variable>
            <variable name="automaticMode"><type><BOOL /></type></variable>
            <variable name="offlineMode"><type><BOOL /></type></variable>
            <variable name="error"><type><BOOL /></type></variable>
            <variable name="alarmHighStatus"><type><BOOL /></type></variable>
            <variable name="warningHighStatus"><type><BOOL /></type></variable>
            <variable name="toleranceHighStatus"><type><BOOL /></type></variable>
            <variable name="toleranceLowStatus"><type><BOOL /></type></variable>
            <variable name="warningLowStatus"><type><BOOL /></type></variable>
            <variable name="alarmLowStatus"><type><BOOL /></type></variable>
            <variable name="programSelectsSP"><type><BOOL /></type></variable>
            <variable name="operatorSelectsSP"><type><BOOL /></type></variable>
            <variable name="manualSPAct"><type><BOOL /></type></variable>
            <variable name="internalSPAct"><type><BOOL /></type></variable>
            <variable name="dynamicSPAct"><type><BOOL /></type></variable>
            <variable name="fixedSPAct"><type><BOOL /></type></variable>
        </outputVars>
        <localVars><!-- Temporary variables for MTP base interface access -->
            <variable name="StateChannel"><type><BOOL /></type></variable>
            <variable name="StateOpAct"><type><BOOL /></type></variable>
            <variable name="StateAutAct"><type><BOOL /></type></variable>
            <variable name="StateOffAct"><type><BOOL /></type></variable>
            <variable name="SrcChannel"><type><BOOL /></type></variable>
            <variable name="SrcManAut"><type><BOOL /></type></variable>
            <variable name="SrcIntAut"><type><BOOL /></type></variable>
            <variable name="SrcIntAct"><type><BOOL /></type></variable>
            <variable name="SrcManAct"><type><BOOL /></type></variable>
            <variable name="WQC"><type><BYTE /></type></variable>
            <variable name="OSLevel"><type><BYTE /></type></variable>
            <variable name="PV"><type><REAL /></type></variable>
            <variable name="PVSclMin"><type><REAL /></type></variable>
            <variable name="PVSclMax"><type><REAL /></type></variable>
            <variable name="PVUnit"><type><INT /></type></variable>
            <variable name="SPInt"><type><REAL /></type></variable>
            <variable name="SPSclMin"><type><REAL /></type></variable>
            <variable name="SPSclMax"><type><REAL /></type></variable>
            <variable name="SPUnit"><type><INT /></type></variable>
            <variable name="SPIntMin"><type><REAL /></type></variable>
            <variable name="SPIntMax"><type><REAL /></type></variable>
            <variable name="SPManMin"><type><REAL /></type></variable>
            <variable name="SPManMax"><type><REAL /></type></variable>
            <variable name="SP"><type><REAL /></type></variable>
            <variable name="MV"><type><REAL /></type></variable>
            <variable name="MVMin"><type><REAL /></type></variable>
            <variable name="MVMax"><type><REAL /></type></variable>
            <variable name="MVUnit"><type><INT /></type></variable>
            <variable name="MVSclMin"><type><REAL /></type></variable>
            <variable name="MVSclMax"><type><REAL /></type></variable>
            <variable name="P"><type><REAL /></type></variable>
            <variable name="Ti"><type><REAL /></type></variable>
            <variable name="Td"><type><REAL /></type></variable>
        </localVars>
    </interface>
    <body>
        <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">
                <![CDATA[
// Copy MTP base variables to local temporaries (READ access)
StateChannel := MTPBase.StateChannel;
StateOpAct := MTPBase.StateOpAct;
StateAutAct := MTPBase.StateAutAct;
StateOffAct := MTPBase.StateOffAct;
SrcChannel := MTPBase.SrcChannel;
SrcIntAct := MTPBase.SrcIntAct;
SrcManAct := MTPBase.SrcManAct;
PV := MTPBase.PV;
SP := MTPBase.SP;
MV := MTPBase.MV;
P := MTPBase.P;
Ti := MTPBase.Ti;
Td := MTPBase.Td;


WQC := 16#FF;
OSLevel := 16#00;
remote := StateChannel;
operatorMode := StateOpAct;
automaticMode := StateAutAct;
offlineMode := StateOffAct;
programSelectsSP := SrcChannel;
operatorSelectsSP := NOT SrcChannel;
internalSPAct := SrcIntAct;
manualSPAct := SrcManAct;
SrcManAut := activateManualSP;
SrcIntAut := activateDynamicSP OR activateFixedSP;
IF activateFixedSP THEN
    fixedSPAct := TRUE;
END_IF;
IF activateDynamicSP THEN
    fixedSPAct := FALSE;
END_IF;
dynamicSPAct := NOT fixedSPAct;
PV := scaleMin + (WORD_TO_REAL(rawValue) / 27648.0) * (scaleMax - scaleMin);
valueOut := PV;
PVSclMin := scaleMin;
PVSclMax := scaleMax;
PVUnit := valueUnit;
SPInt := (dynamicSP * BOOL_TO_REAL(dynamicSPAct)) + (fixedSP * BOOL_TO_REAL(fixedSPAct));
SPSclMin := scaleMin;
SPSclMax := scaleMax;
SPUnit := valueUnit;
SPIntMin := scaleMin;
SPIntMax := scaleMax;
SPManMin := scaleMin;
SPManMax := scaleMax;
setpointOut := SP;
manipulatedValue := MV;
MVMin := scaleMinMV;
MVMax := scaleMaxMV;
MVUnit := manipulatedValueUnit;
MVSclMin := scaleMinMV;
MVSclMax := scaleMaxMV;
activateManualSP := False;
activateDynamicSP := False;
activateFixedSP := False;

// Copy local temporaries back to MTP base variables (WRITE access)
MTPBase.SrcManAut := SrcManAut;
MTPBase.SrcIntAut := SrcIntAut;
MTPBase.WQC := WQC;
MTPBase.OSLevel := OSLevel;
MTPBase.PV := PV;
MTPBase.PVSclMin := PVSclMin;
MTPBase.PVSclMax := PVSclMax;
MTPBase.PVUnit := PVUnit;
MTPBase.SPInt := SPInt;
MTPBase.SPSclMin := SPSclMin;
MTPBase.SPSclMax := SPSclMax;
MTPBase.SPUnit := SPUnit;
MTPBase.SPIntMin := SPIntMin;
MTPBase.SPIntMax := SPIntMax;
MTPBase.SPManMin := SPManMin;
MTPBase.SPManMax := SPManMax;
MTPBase.MVMin := MVMin;
MTPBase.MVMax := MVMax;
MTPBase.MVUnit := MVUnit;
MTPBase.MVSclMin := MVSclMin;
MTPBase.MVSclMax := MVSclMax;
                ]]>
            </xhtml>
        </ST>
    </body>
</pou>